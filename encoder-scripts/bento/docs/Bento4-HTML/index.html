<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Bento4 MP4 SDK: Bento4 SDK</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Bento4 SDK</h1>
<p>
<h3 align="center">0.9 </h3><h2><a class="anchor" name="intro_sec">
Introduction</a></h2>
Bento4/AP4 is a C++ class library designed to read and write ISO-MP4 files. This format is defined in ISO/IEC 14496-12, 14496-14 and 14496-15. The format is a derivative of the Apple Quicktime file format. Because of that, Bento4 can be used to read and write a number of Quicktime files as well, even though some Quicktime specific features are not supported. In addition, Bento4 supports a number of extensions as defined in various other specifications. This includes some support for ISMA Encrytion and Decryption as defined in the ISMA E&amp;A specification (<a href="http://www.isma.tv">http://www.isma.tv</a>), OMA 2.0 PDCF Encryption and Decryption as defined in the OMA 2.0 PDCF specification (<a href="http://www.openmobilealliance.org">http://www.openmobilealliance.org</a>) and iTunes compatible metadata. The SDK includes a number of command line tools, built using the class library, that serve as general purpose tools as well as examples of how to use the API.<p>
The SDK is designed to be cross-platform. The code is very portable; it can be compiled with any sufficiently modern C++ compiler. The code does not rely on any external library; all the code necessary to compile the SDK and its tools is included in the standard distribution. The standard distribution contains makefiles for unix-like operating systems, including Linux, project files for Microsoft Visual Studio, and an XCode project for MacOS X. There is also support for building the library with the SCons build system.<h2><a class="anchor" name="building">
Building the SDK</a></h2>
Building the SDK will produce a C++ class library and some command line tools. For the makefile-based configurations, 'make sdk' will produce an SDK directory layout with a bin/ lib/ and include/ subdirectories containing respectively the binaries, library and header files.<h3><a class="anchor" name="build_win32">
Windows</a></h3>
Open the solution file Build/Targets/Build/Targets/x86-microsoft-win32-vs2005 Building the solution will build the class library and command line tools. The script Build/Targets/Build/Targets/x86-microsoft-win32-vs2005/make-sdk.sh will create the SDK directory structure as described above.<h3><a class="anchor" name="build_linux">
Linux</a></h3>
Go to Build/Targets/x86-unknown-linux or Build/Targets/&lt;target-name&gt; for any linux-based target, and use the 'make' command to build the library and tools, or 'make sdk' to build the SDK directory structure.<h3><a class="anchor" name="build_cygwin">
Cygwin</a></h3>
Go to Build/Targets/x86-unknown-cygwin and follow the same instructions as for the Linux platform.<h3><a class="anchor" name="build_macos">
MacOS</a></h3>
Use the XCode project file located under Build/Targets/ppc-apple-macosx<h3><a class="anchor" name="build_scons">
Using SCons</a></h3>
There is experimental support for building the SDK using the python-based SCons tool (<a href="http://www.scons.org">http://www.scons.org</a>). The top level configuration is located at the root of the SDK, and will output all the object files and binaries to a sub-directory under Build/SCons/Targets/&lt;target-name&gt;/&lt;config-name&gt;.<h3><a class="anchor" name="build_others">
Other Platforms</a></h3>
Other plaftorms can be built by adapting the makefiles for the generic gcc-based configurations.<h2><a class="anchor" name="mp4_structure">
Structure of an MP4 file</a></h2>
An MP4 file consists of a tree of atoms (also known as boxes). The atoms contain the information about the different media tracks for the file, as well as other information, such as metadata. The Bento4 class library parses files an constructs an in-memory representation of the atoms, and provides an API that is an abstraction layer for the way the information is actually encoded in those atoms.<h2><a class="anchor" name="reading">
Reading Files</a></h2>
The class <a class="el" href="classAP4__File.html" title="The AP4_File object is the top level object for MP4 Files.">AP4_File</a> represents all the information about an MP4 file. Internally, a tree of <a class="el" href="classAP4__Atom.html" title="Abstract base class for all atom types.">AP4_Atom</a> objects plus other helper objects holds the actual information. To create an instance of the class, the caller must pass a reference to an <a class="el" href="classAP4__ByteStream.html">AP4_ByteStream</a> object that represents the file data storage. The SDK includes two subclasses of the abstract <a class="el" href="classAP4__ByteStream.html">AP4_ByteStream</a> class: <a class="el" href="classAP4__FileByteStream.html">AP4_FileByteStream</a> for reading/writing disk-based files and <a class="el" href="classAP4__MemoryByteStream.html">AP4_MemoryByteStream</a> for working with in-memory file images. Once you have created an <a class="el" href="classAP4__File.html" title="The AP4_File object is the top level object for MP4 Files.">AP4_File</a> object, you can get to the media data by accessing the <a class="el" href="classAP4__Track.html">AP4_Track</a> objects of its <a class="el" href="classAP4__Movie.html">AP4_Movie</a> (see <a class="el" href="classAP4__File.html#2709c2dc1eee300ca905f95db6888466" title="Get the AP4_Movie object of this file.">AP4_File::GetMovie</a>). The <a class="el" href="classAP4__Track.html">AP4_Track</a> exposes the necessary methods for you to get the <a class="el" href="classAP4__SampleDescription.html">AP4_SampleDescription</a> (typically to initialize your decoder) and to get the <a class="el" href="classAP4__Sample.html">AP4_Sample</a> objects from the track. These <a class="el" href="classAP4__Sample.html">AP4_Sample</a> objects give you the meta information you need (such as timestamps) as well as the sample data that they point to. You can also explore the entire tree of atoms by calling <a class="el" href="classAP4__File.html#e8c9cf852f9f2426798d963b5d2ef69a" title="Inspect the content of the file with an AP4_AtomInspector.">AP4_File::Inspect</a>, passing an instance of <a class="el" href="classAP4__AtomInspector.html" title="Class used in a visitor pattern to walk all the atoms in a tree of AP4_Atom objects...">AP4_AtomInspector</a>. <a class="el" href="classAP4__AtomInspector.html" title="Class used in a visitor pattern to walk all the atoms in a tree of AP4_Atom objects...">AP4_AtomInspector</a> is an abstract base class for a visitor of the tree of <a class="el" href="classAP4__Atom.html" title="Abstract base class for all atom types.">AP4_Atom</a> objects. The SDK includes an concrete subclass, <a class="el" href="classAP4__PrintInspector.html">AP4_PrintInspector</a>, can be used to print out a text representation of the atoms as they are visited. See the Mp4Dump command line application for an example.<h2><a class="anchor" name="writing">
Writing Files</a></h2>
To create a new MP4 file, you first create an <a class="el" href="classAP4__SyntheticSampleTable.html">AP4_SyntheticSampleTable</a> sample table for each track in your file. You specify the sample description for the media samples in each track by calling <a class="el" href="classAP4__SyntheticSampleTable.html#20f561af5601ab0b4218b290199300cf">AP4_SyntheticSampleTable::AddSampleDescription</a> with the description for the samples of that track. Samples can then be added to the sample table with the <a class="el" href="classAP4__SyntheticSampleTable.html#4148218832614a325973444a74b85473">AP4_SyntheticSampleTable::AddSample</a> method. Once all the samples of all the tracks have been added to the sample tables, you can create an <a class="el" href="classAP4__Movie.html">AP4_Movie</a>, and an <a class="el" href="classAP4__Track.html">AP4_Track</a> from each sample table, add the track to the movie, and finally create an <a class="el" href="classAP4__File.html" title="The AP4_File object is the top level object for MP4 Files.">AP4_File</a> from the movie object. Finally, the <a class="el" href="classAP4__File.html" title="The AP4_File object is the top level object for MP4 Files.">AP4_File</a> object can be serialized to a byte stream (such as an <a class="el" href="classAP4__FileByteStream.html">AP4_FileByteStream</a>) using the <a class="el" href="classAP4__FileWriter.html">AP4_FileWriter</a> class. See the Aac2Mp4 application for an example.<h2><a class="anchor" name="tracks">
Tracks</a></h2>
The <a class="el" href="classAP4__Movie.html">AP4_Movie</a> object of an <a class="el" href="classAP4__File.html" title="The AP4_File object is the top level object for MP4 Files.">AP4_File</a> has a list of <a class="el" href="classAP4__Track.html">AP4_Track</a> objects. Each <a class="el" href="classAP4__Track.html">AP4_Track</a> represents a media track in the file. From this object, you can obtain the type, duration, etc.. of the tracks. This object also provides access to the media samples in the track. Tracks are made up of media samples, stored in an 'mdat' atom (media data) and a sample table that provides all the information about the individual samples, such as size, timestamps, sample description, etc... Media samples are represented by <a class="el" href="classAP4__Sample.html">AP4_Sample</a> objects. You can obtain a track's samples by calling the <a class="el" href="classAP4__Track.html#bcb4bc7db71cf4176eac211123de610b">AP4_Track::GetSample</a> method. You can also directly read the payload of a media sample by calling the <a class="el" href="classAP4__Track.html#c1e8492cce4d06b8e3aa37f856c766c7">AP4_Track::ReadSample</a> method if you want to bypass the intermediate step of going through an <a class="el" href="classAP4__Sample.html">AP4_Sample</a> object. The information about the samples in a track is represented by subclasses of the <a class="el" href="classAP4__SampleDescription.html">AP4_SampleDescription</a> class. The sample descriptions contain information about media-specific parameters, such as video resolution, audio sampling rates and others. See the Mp4Info and Mp42Aac command line applications as examples.<h2><a class="anchor" name="advanced">
Advanced Topics</a></h2>
<h3><a class="anchor" name="factory">
Custom Atoms</a></h3>
The SDK has built-in support for most of the standard atom types as defined in the spec. But an application may want to extend the library to support non-standard atom type, such as custom atoms whose definition is proprietary. The base class for all atoms is <a class="el" href="classAP4__Atom.html" title="Abstract base class for all atom types.">AP4_Atom</a>. Instances of subclasses of this class are created by the <a class="el" href="classAP4__AtomFactory.html">AP4_AtomFactory</a> object. The factory knows about all the <a class="el" href="classAP4__Atom.html" title="Abstract base class for all atom types.">AP4_Atom</a> subclasses included in the SDK, and maintains a list of <a class="el" href="classAP4__AtomFactory_1_1TypeHandler.html">AP4_AtomFactory::TypeHandler</a> type handlers. When the factory encounters an atom that is not one of the built-in atom type, it calls all the registered type handlers, in turn, until one of them accept to handle the type and create the corresponding atom. The custom atoms must be implemented as subclasses of <a class="el" href="classAP4__Atom.html" title="Abstract base class for all atom types.">AP4_Atom</a> and override at least the <a class="el" href="classAP4__Atom.html#64855266ce814f9089f1754121d78aa4">AP4_Atom::WriteFields</a> method. The custom atoms should also override <a class="el" href="classAP4__Atom.html#19b4eb3cfa9314152a7dca5757596031">AP4_Atom::InspectFields</a> if they want to provide meaningful information when inspected.<h3><a class="anchor" name="tranformations">
Transformations</a></h3>
The SDK provides support for transforming MP4 files. Transformations are useful to perform tasks such as editing (removing or adding atoms) and encryption or decryption. When the atom tree for the file changes, the entire file needs to change, because in most cases, the size of the 'moov' atom will change, and thus change the offset of the media samples in the 'mdat' atom. To facilitate this operation, the class <a class="el" href="classAP4__Processor.html">AP4_Processor</a> provides the base functionality for managing all the updates to the sample tables. Subclasses of the <a class="el" href="classAP4__Processor.html">AP4_Processor</a> class can override certain methods to carry out specific changes to the structure of the atom tree and/or the media samples. <a class="el" href="classAP4__Processor.html">AP4_Processor</a> defines an abstract base class, <a class="el" href="classAP4__Processor_1_1TrackHandler.html" title="Abstract class that defines the interface implemented by concrete track handlers...">AP4_Processor::TrackHandler</a> that defines the interface that specific track modification classes must implement. A subclass of <a class="el" href="classAP4__Processor.html">AP4_Processor</a> may create such an <a class="el" href="classAP4__Processor_1_1TrackHandler.html" title="Abstract class that defines the interface implemented by concrete track handlers...">AP4_Processor::TrackHandler</a> subclass instance when is <a class="el" href="classAP4__Processor.html#87ef49e501b73dc5e9b9b63e1f970f75" title="This method can be overridden by concrete subclasses.">AP4_Processor::CreateTrackHandler</a> is called for one of the tracks in the file. See the sample applications Mp4Edit, Mp4Encrpt and Mp4Decrypt as examples.<h3><a class="anchor" name="encryption">
Encryption and Decryption</a></h3>
The SDK has support for encrypting and decrypting tracks as specified by the ISMA Encryption and Authentication specification as well as OMA 2.0 PDCF. The supporting classes found in <a class="el" href="Ap4IsmaCryp_8h.html">Ap4IsmaCryp.h</a> and AP4_OmaDcf.h provide a subclass of <a class="el" href="classAP4__Processor.html">AP4_Processor</a> for encrypting or decrypting entire files. The class <a class="el" href="classAP4__IsmaCipher.html">AP4_IsmaCipher</a> and <a class="el" href="classAP4__OmaDcfSampleDecrypter.html">AP4_OmaDcfSampleDecrypter</a> implement the generic <a class="el" href="classAP4__SampleDecrypter.html">AP4_SampleDecrypter</a> interface that provides support for decrypting individual samples. The parameters necessary to instantiate an <a class="el" href="classAP4__IsmaCipher.html">AP4_IsmaCipher</a> or an <a class="el" href="classAP4__OmaDcfSampleDecrypter.html">AP4_OmaDcfSampleDecrypter</a> can be retrieved from an encrypted track by accessing the track's sample descriptions, which are instances of the <a class="el" href="classAP4__ProtectedSampleDescription.html">AP4_ProtectedSampleDescription</a> class.<h3><a class="anchor" name="RTP">
Packets</a></h3>
For files that contain hint tracks, the SDK provides support for generating RTP packets that can be used to stream the media using the RTP and RTSP protocols. See the application Mp4RtpHintInfo for an example of how to generate the create RTP packets from a file and generate the SDP information for the RTSP protocol. </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 29 10:53:35 2008 for Bento4 MP4 SDK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
